import{u as E,j as e,B as n,L as x,C as g,a as u,b as T,c as b}from"./index-8HvWlEO9.js";import{r as f,P as F,G as N,B as y,M,m as H}from"./vendor-ui-BfR-HH66.js";import{D as O,a as P,b as S,c as z,d as L,e as k,f as q}from"./dialog-BJngghRx.js";import{T as I}from"./textarea-Dzc1DlSm.js";import{a as V,f as J}from"./vendor-date-OvfWL3xb.js";import{p as v}from"./pt-BR-nHefkTwq.js";import"./vendor-react-CRB3T2We.js";function A({announcements:h,companies:d=[],onAddAnnouncement:o,onMarkAsRead:t}){const{user:i}=E(),l=(i==null?void 0:i.role)==="admin",[w,m]=f.useState(!1),[a,c]=f.useState({message:"",company_id:"",isGlobal:!0}),C=async()=>{if(a.message.trim())try{await(o==null?void 0:o({message:a.message,company_id:a.isGlobal?void 0:a.company_id})),c({message:"",company_id:"",isGlobal:!0}),m(!1)}catch(s){console.error("Erro ao adicionar comunicado:",s)}},D=async s=>{try{await(t==null?void 0:t(s))}catch(r){console.error("Erro ao marcar como lido:",r)}},G=s=>{try{return J(new Date(s),{addSuffix:!0,locale:v})}catch{return"Data indisponível"}},_=s=>{try{return V(new Date(s),"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:v})}catch{return s}},p=[...l?h.filter(s=>s.active):h.filter(s=>s.active&&(s.company_id===null||s.company_id===void 0||s.company_id===(i==null?void 0:i.company_id)))].sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime());return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Mural de Comunicados"}),e.jsx("p",{className:"text-slate-600 text-lg",children:l?"Gerencie comunicados globais e específicos por empresa":"Acompanhe os comunicados e atualizações"})]}),l&&o&&e.jsxs(O,{open:w,onOpenChange:m,children:[e.jsx(P,{asChild:!0,children:e.jsxs(n,{className:"bg-[#2563EB] hover:bg-[#1d4ed8]",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Novo Comunicado"]})}),e.jsxs(S,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Adicionar Comunicado"}),e.jsx(k,{children:"Crie um comunicado global ou específico para uma empresa."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"isGlobal",children:"Tipo de Comunicado"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"isGlobal",checked:a.isGlobal,onChange:()=>c({...a,isGlobal:!0,company_id:""}),className:"w-4 h-4"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),"Global (todos os clientes)"]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"isGlobal",checked:!a.isGlobal,onChange:()=>c({...a,isGlobal:!1}),className:"w-4 h-4"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),"Específico (uma empresa)"]})]})]})]}),!a.isGlobal&&d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"company_id",children:"Empresa"}),e.jsxs("select",{id:"company_id",className:"w-full p-2 border border-slate-300 rounded-md",value:a.company_id,onChange:s=>c({...a,company_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Selecione uma empresa..."}),d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"message",children:"Mensagem *"}),e.jsx(I,{id:"message",placeholder:"Digite o comunicado aqui...",rows:6,value:a.message,onChange:s=>c({...a,message:s.target.value})})]})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(n,{className:"bg-[#2563EB] hover:bg-[#1d4ed8]",onClick:C,disabled:!a.message.trim()||!a.isGlobal&&!a.company_id,children:"Publicar"})]})]})]})]}),p.length===0?e.jsx(g,{className:"text-center py-12",children:e.jsxs(u,{children:[e.jsx(M,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-slate-600 mb-2",children:"Nenhum comunicado disponível"}),e.jsx("p",{className:"text-slate-500",children:l?"Comece adicionando comunicados usando o botão acima.":"Não há comunicados no momento."})]})}):e.jsx("div",{className:"space-y-4",children:p.map(s=>{var j;const r=s.company_id?(j=d.find(B=>B.id===s.company_id))==null?void 0:j.name:null;return e.jsxs(g,{className:"hover:shadow-md transition-shadow border-l-4 border-l-[#2563EB]",children:[e.jsx(T,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.company_id?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 text-slate-500"}),e.jsx(b,{variant:"secondary",children:r||"Empresa específica"})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 text-slate-500"}),e.jsx(b,{variant:"default",children:"Global"})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 mb-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:_(s.date)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:G(s.date)})]})]})})}),e.jsxs(u,{children:[e.jsx("p",{className:"text-slate-700 whitespace-pre-wrap leading-relaxed",children:s.message}),!l&&t&&e.jsx(n,{variant:"ghost",size:"sm",className:"mt-4 text-[#2563EB] hover:text-[#1d4ed8] hover:bg-[#2563EB]/10",onClick:()=>D(s.id),children:"Marcar como lido"})]})]},s.id)})})]})}export{A as BroadcastView};
